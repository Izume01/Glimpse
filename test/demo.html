<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Glimpse Analytics Demo</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0 auto;
      padding: 2.5rem 2rem;
      line-height: 1.6;
      max-width: 960px;
      color: #e5e7eb;
      background: radial-gradient(1200px circle at 10% -10%, #1f2937 0%, #0b0f17 45%, #06090f 100%);
    }

    h1 {
      color: #f8fafc;
      font-size: 2.25rem;
      margin-bottom: 0.5rem;
      letter-spacing: -0.02em;
    }

    h3 {
      margin-top: 0;
      color: #c7d2fe;
      border-bottom: 2px solid #4f46e5;
      padding-bottom: 0.5rem;
      display: inline-block;
    }

    h4 {
      margin-top: 0;
      color: #e2e8f0;
    }

    p.intro {
      color: #94a3b8;
      margin-bottom: 2rem;
    }

    button {
      margin: 0.25rem;
      padding: 0.65rem 1.2rem;
      cursor: pointer;
      background: #4f46e5;
      color: #eef2ff;
      border: 1px solid #4338ca;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    button:hover {
      background: #4338ca;
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(79, 70, 229, 0.25);
    }

    button.secondary {
      background: #1f2937;
      border-color: #334155;
      color: #e2e8f0;
    }

    button.secondary:hover {
      background: #334155;
    }

    button.danger {
      background: #b91c1c;
      border-color: #991b1b;
      color: #fee2e2;
    }

    button.danger:hover {
      background: #991b1b;
    }

    code {
      background: #0f172a;
      padding: 0.2rem 0.5rem;
      border-radius: 6px;
      font-size: 0.85em;
      font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
      color: #93c5fd;
      border: 1px solid #1f2937;
    }

    section {
      margin-bottom: 1.5rem;
      padding: 1.5rem;
      border: 1px solid #1f2937;
      border-radius: 14px;
      background: #0f172a;
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.25);
    }

    .status {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(16, 185, 129, 0.05) 100%);
      padding: 1rem 1.25rem;
      border-radius: 10px;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 0.9rem;
      border-left: 4px solid #10b981;
      color: #a7f3d0;
    }

    a {
      color: #60a5fa;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    form {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      flex-wrap: wrap;
    }

    input {
      padding: 0.6rem 0.8rem;
      border: 1px solid #1f2937;
      border-radius: 8px;
      font-size: 0.9rem;
      transition: border-color 0.2s, box-shadow 0.2s;
      background: #0b1220;
      color: #e5e7eb;
    }

    input:focus {
      outline: none;
      border-color: #4f46e5;
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.25);
    }

    .note {
      font-size: 0.85rem;
      color: #94a3b8;
      margin-top: 1rem;
      padding: 0.75rem;
      background: #0b1220;
      border-radius: 8px;
      border-left: 3px solid #4f46e5;
    }

    .scroll-area {
      min-height: 200vh;
      background: linear-gradient(180deg, #0b0f17 0%, #0f172a 100%);
      padding: 1.5rem;
      margin-top: 1rem;
      border-radius: 14px;
      border: 1px solid #111827;
    }

    .tracked-section {
      padding: 2rem;
      border-radius: 14px;
      box-shadow: 0 18px 30px rgba(0, 0, 0, 0.35);
      border: 1px solid rgba(148, 163, 184, 0.2);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .metric {
      background: linear-gradient(135deg, #0b1220 0%, #0f172a 100%);
      padding: 1.25rem;
      border-radius: 12px;
      text-align: center;
      border: 1px solid #1f2937;
    }

    .metric-value {
      font-size: 1.25rem;
      font-weight: 700;
      color: #a5b4fc;
      font-family: 'SF Mono', Monaco, monospace;
    }

    .metric-label {
      font-size: 0.75rem;
      color: #94a3b8;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-top: 0.25rem;
    }

    video {
      max-width: 100%;
      border-radius: 8px;
      margin-top: 0.75rem;
    }

    ul {
      padding-left: 1.25rem;
      margin: 0.75rem 0;
    }

    li {
      margin: 0.5rem 0;
      color: #cbd5f5;
    }

    li strong {
      color: #e2e8f0;
    }

    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.75rem;
    }

    .links {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .scroll-marker {
      margin-top: 10vh;
      text-align: center;
      font-size: 1.25rem;
      color: #94a3b8;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <h1>Glimpse Analytics Demo</h1>
  <p class="intro">
    SDK v2.0 with identity tracking, Web Vitals, engagement metrics, and more.
    Events are sent to <code>http://localhost:3000/event</code>
  </p>

  <section>
    <h3>Status</h3>
    <div id="status" class="status">Initializing tracker...</div>
    <div class="grid" id="metrics">
      <div class="metric">
        <div class="metric-value" id="m-session">-</div>
        <div class="metric-label">Session ID</div>
      </div>
      <div class="metric">
        <div class="metric-value" id="m-anon">-</div>
        <div class="metric-label">Anonymous ID</div>
      </div>
      <div class="metric">
        <div class="metric-value" id="m-user">-</div>
        <div class="metric-label">User ID</div>
      </div>
    </div>
  </section>

  <section>
    <h3>Identity Tracking</h3>
    <p>Track users across sessions with persistent IDs</p>
    <form id="identify-form" onsubmit="return false;">
      <input type="text" id="user-id" placeholder="User ID (e.g. user_123)" />
      <input type="text" id="user-email" placeholder="Email (trait)" />
      <button type="submit" id="btn-identify">Identify User</button>
    </form>
    <div class="button-group">
      <button class="secondary" id="btn-traits">Add Traits</button>
      <button class="danger" id="btn-reset">Reset Identity</button>
    </div>
    <p class="note"><code>identify(userId, traits)</code> links anonymous activity to a user</p>
  </section>

  <section>
    <h3>Custom Events</h3>
    <p>Track custom events with <code>track(name, properties)</code></p>
    <div class="button-group">
      <button id="btn-cta">Track CTA Click</button>
      <button id="btn-purchase">Track Purchase</button>
      <button id="btn-signup">Track Sign Up</button>
      <button id="btn-custom">Track Custom</button>
    </div>
    <p class="note">Fires custom events with your own properties</p>
  </section>

  <section>
    <h3>Auto Button Tracking</h3>
    <p>Buttons with <code>data-track</code> are automatically tracked</p>
    <div class="button-group">
      <button data-track data-track-name="Primary Action">Primary Action</button>
      <button data-track data-track-name="Secondary Action">Secondary Action</button>
      <button data-track>Unnamed Button</button>
    </div>
    <p class="note">Add <code>data-track</code> attribute to any button</p>
  </section>

  <section>
    <h3>Form Tracking</h3>
    <p>Form submissions and field focus are automatically tracked</p>
    <form id="demo-form" action="#submitted">
      <input type="text" name="name" placeholder="Your name" />
      <input type="email" name="email" placeholder="Email" />
      <button type="submit">Submit</button>
    </form>
    <p class="note">Tracks form submissions and field focus without capturing PII</p>
  </section>

  <section>
    <h3>Link &amp; Download Tracking</h3>
    <p>External links and file downloads are automatically tracked</p>
    <div class="links">
      <a href="https://github.com" target="_blank">GitHub (External)</a>
      <a href="https://google.com" target="_blank">Google (External)</a>
      <a href="/files/sample.pdf">Download PDF</a>
      <a href="/files/report.xlsx">Download Excel</a>
    </div>
    <p class="note">Auto-tracks outbound clicks and file downloads</p>
  </section>

  <section>
    <h3>Error Tracking</h3>
    <p>Capture JavaScript errors and promise rejections</p>
    <div class="button-group">
      <button class="danger" id="btn-error">Trigger JS Error</button>
      <button class="danger" id="btn-promise-error">Trigger Promise Rejection</button>
    </div>
    <p class="note">Auto-captures errors with stack traces</p>
  </section>

  <section>
    <h3>Performance &amp; Web Vitals</h3>
    <p>Automatically tracks page load performance</p>
    <ul>
      <li><strong>Page Load</strong> - DNS, TTFB, DOM ready, load complete</li>
      <li><strong>LCP</strong> - Largest Contentful Paint</li>
      <li><strong>FCP</strong> - First Contentful Paint</li>
      <li><strong>FID</strong> - First Input Delay</li>
      <li><strong>CLS</strong> - Cumulative Layout Shift</li>
      <li><strong>TTFB</strong> - Time to First Byte</li>
    </ul>
    <p class="note">Web Vitals tracked with good / needs-improvement / poor ratings</p>
  </section>

  <section>
    <h3>Engagement Tracking</h3>
    <p>Measures user engagement and interaction quality</p>
    <ul>
      <li><strong>Active Time</strong> - Time user is actually engaged</li>
      <li><strong>Scroll Depth</strong> - Maximum scroll position reached</li>
      <li><strong>Interactions</strong> - Clicks, keypresses, touches</li>
      <li><strong>Bounce Detection</strong> - Left without engaging</li>
      <li><strong>Rage Clicks</strong> - Frustration indicator</li>
      <li><strong>Page Exit</strong> - Comprehensive exit data</li>
    </ul>
    <p class="note">Tracks 30-second heartbeats for long sessions</p>
  </section>

  <section>
    <h3>Media Tracking</h3>
    <p>Track video and audio engagement with <code>data-track</code></p>
    <video data-track="demo-video" controls width="400" poster="https://via.placeholder.com/400x225?text=Demo+Video">
      <source src="https://www.w3schools.com/html/mov_bbb.mp4" type="video/mp4">
    </video>
    <p class="note">Tracks play, pause, progress milestones (25/50/75%), and complete</p>
  </section>

  <section>
    <h3>Scroll &amp; Visibility Tracking</h3>
    <p>Scroll down to see element visibility tracking in action</p>
    <p class="note">Tracks scroll milestones: 25%, 50%, 75%, 90%, 100%</p>
  </section>

  <div class="scroll-area">
    <p style="text-align: center; color: #94a3b8;">Keep scrolling to trigger visibility events...</p>

    <div data-track-view="pricing-section" data-track-name="Pricing Section" class="tracked-section" style="margin-top: 20vh; background: linear-gradient(135deg, #0b2341 0%, #0f172a 100%);">
      <h4>Pricing Section</h4>
      <p>Tracked via <code>data-track-view</code></p>
    </div>

    <div id="custom-section-1" class="tracked-section" style="margin-top: 20vh; background: linear-gradient(135deg, #2a0f2a 0%, #0f172a 100%);">
      <h4>Testimonials Section</h4>
      <p>Tracked via <code>trackOnView('#custom-section-1', 'Viewed Testimonials')</code></p>
    </div>

    <div data-track-view="features-section" data-track-name="Features Section" class="tracked-section" style="margin-top: 20vh; background: linear-gradient(135deg, #2a240f 0%, #0f172a 100%);">
      <h4>Features Section</h4>
      <p>Tracked via <code>data-track-view</code></p>
    </div>

    <div id="custom-section-2" class="tracked-section" style="margin-top: 20vh; background: linear-gradient(135deg, #1f1240 0%, #0f172a 100%);">
      <h4>Product Demo Section</h4>
      <p>Tracked with 75% visibility threshold</p>
    </div>

    <div data-track-view="cta-section" data-track-name="Call to Action" class="tracked-section" style="margin-top: 20vh; background: linear-gradient(135deg, #0f2a1c 0%, #0f172a 100%);">
      <h4>Final CTA</h4>
      <p>You've reached the bottom!</p>
    </div>

    <p class="scroll-marker">100% scroll depth reached</p>
  </div>

  <section style="margin-top: 1.5rem;">
    <h3>Session End</h3>
    <p>Closing or navigating away tracks "Session End" with full engagement data.</p>
    <p class="note">Uses <code>sendBeacon</code> for reliable delivery on unload</p>
  </section>

  <script type="module" src="../packages/analytics-web/index.js" data-project-id="demo_project"></script>

  <script type="module">
    function setStatus(msg) {
      const el = document.getElementById('status');
      if (el) el.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
    }

    function updateMetrics() {
      const tracker = window.GlimpseTracker;
      if (!tracker) return;

      document.getElementById('m-session').textContent = tracker.getSessionId?.()?.slice(-8) || '-';
      document.getElementById('m-anon').textContent = tracker.getAnonymousId?.()?.slice(-8) || '-';
      document.getElementById('m-user').textContent = tracker.getUserId?.() || '(none)';
    }

    const checkTracker = setInterval(() => {
      const tracker = window.GlimpseTracker;
      if (tracker?.projectId) {
        clearInterval(checkTracker);
        initDemo();
      }
    }, 100);

    function initDemo() {
      const tracker = window.GlimpseTracker;

      setStatus(`Tracker v${tracker.version || '2.0'} ready | Project: ${tracker.projectId}`);
      updateMetrics();

      document.getElementById('btn-identify')?.addEventListener('click', () => {
        const userId = document.getElementById('user-id').value || 'user_' + Date.now();
        const email = document.getElementById('user-email').value;
        tracker.identify(userId, email ? { email, plan: 'pro' } : {});
        setStatus(`Identified as: ${userId}`);
        updateMetrics();
      });

      document.getElementById('btn-traits')?.addEventListener('click', () => {
        tracker.setTraits({ lastSeen: new Date().toISOString(), visits: 5 });
        setStatus('Added traits: lastSeen, visits');
      });

      document.getElementById('btn-reset')?.addEventListener('click', () => {
        tracker.reset();
        setStatus('Identity reset');
        updateMetrics();
      });

      document.getElementById('btn-cta')?.addEventListener('click', () => {
        tracker.track('CTA Clicked', { label: 'demo_cta', position: 'header' });
        setStatus('Tracked: CTA Clicked');
      });

      document.getElementById('btn-purchase')?.addEventListener('click', () => {
        tracker.track('Purchase', { amount: 99.99, currency: 'USD', plan: 'Pro Annual' });
        setStatus('Tracked: Purchase $99.99');
      });

      document.getElementById('btn-signup')?.addEventListener('click', () => {
        tracker.track('Sign Up', { method: 'email', source: 'demo' });
        setStatus('Tracked: Sign Up');
      });

      document.getElementById('btn-custom')?.addEventListener('click', () => {
        tracker.track('Custom Event', {
          foo: 'bar',
          timestamp: Date.now(),
          nested: { key: 'value' }
        });
        setStatus('Tracked: Custom Event');
      });

      document.getElementById('btn-error')?.addEventListener('click', () => {
        setStatus('Triggering JS error...');
        setTimeout(() => { throw new Error('Intentional test error'); }, 100);
      });

      document.getElementById('btn-promise-error')?.addEventListener('click', () => {
        setStatus('Triggering promise rejection...');
        Promise.reject(new Error('Intentional promise rejection'));
      });

      document.getElementById('demo-form')?.addEventListener('submit', (e) => {
        e.preventDefault();
        setStatus('Form submitted (auto-tracked)');
      });

      tracker.trackOnView?.('#custom-section-1', 'Viewed Testimonials', {
        section: 'testimonials'
      });

      tracker.trackOnView?.('#custom-section-2', 'Viewed Product Demo', {
        section: 'product-demo',
        variant: 'A'
      }, { threshold: 0.75 });
    }
     </script>
</body>
</html>
